<?xml version="1.0"?>
<rules version="2010.3" author="andi">
	<!-- Attributes -->
	<attr name="groundf_height" value="4"/>
	<attr name="floor_height" value="3.5"/>
	<attr name="tile_width" value="3"/>
	<attr name="bldg_height" value="11"/>
	<attr name="wallColor" value="#ffffff"/>
	<attr name="LOD" value="0"/>
	
	<!-- Assets -->
	<attr name="window_asset" value="../assets/primitives/window.obj"/>
	<attr name="cube_notex" value="../assets/primitives/cube_notex.obj"/>
	<attr name="frontdoor_tex" value="../assets/textures/shopdoor.tif"/>
	<attr name="wall_tex" value="../assets/textures/brickwall.jpg"/>
	<attr name="roof_tex" value="../assets/textures/roof.tif"/>
	<attr name="window_tex" value="../assets/textures/window.1b.tif"/>
	
	<!-- Initial Shape starting rule -->
	<rule name="Lot">
		<operator name="extrude">
			<param name="height" value="bldg_height"/>
		</operator>
		<operator name="copy">
			<param name="name" value="Building"/>
		</operator>
	</rule>
	
	<!-- split the building geometry into its facade components -->
	<rule name="Building">
		<operator name="comp">
			<param name="front" value="FrontFacade"/>
			<param name="side" value="SideFacade"/>
			<param name="top" value="Roof"/>
		</operator>
	</rule>
	
	<!-- the front facade is subdivided into one front groundfloor and upper floors -->
	<rule name="FrontFacade">
		<operator name="setupProjection">
			<param name="axesSelector" value="scope.xy"/>
			<param name="texWidth" type="absolute" value="1.5"/>
			<param name="texHeight" type="absolute" value="1"/>
		</operator>
		<operator name="texture">
			<param name="texture" value="wall_tex"/>
		</operator>
		<operator name="split">
			<param name="splitAxis" value="y"/>
			<param name="size">
				<element type="absolute" value="groundf_height"/>
				<element type="floating" value="floor_height" repeat="true"/>
			</param>
			<param name="name">
				<element value="Groundfloor"/>
				<element value="Floor"/>
			</param>
		</operator>
	</rule>
	
	<!-- a side facade is subdivided into one bottom floor and upper floors. -->
	<rule name="SideFacade">
		<operator name="setupProjection">
			<param name="axesSelector" value="scope.xy"/>
			<param name="texWidth" type="absolute" value="1.5"/>
			<param name="texHeight" type="absolute" value="1"/>
		</operator>
		<operator name="texture">
			<param name="texture" value="wall_tex"/>
		</operator>
		<operator name="split">
			<param name="splitAxis" value="y"/>
			<param name="size">
				<element type="absolute" value="groundf_height"/>
				<element type="floating" value="floor_height" repeat="true"/>
			</param>
			<param name="name">
				<element value="Floor"/>
				<element value="Floor"/>
			</param>
		</operator>
	</rule>
	
	<!-- a roof texture is applied to the roof face -->
	<rule name="Roof">
		<operator name="setupProjection">
			<param name="axesSelector" value="scope.xy"/>
			<param name="texWidth" type="absolute" value="scope.sx"/>
			<param name="texHeight" type="absolute" value="scope.sy"/>
		</operator>
		<operator name="texture">
			<param name="texture" value="roof_tex"/>
		</operator>
	</rule>
	
	<!-- each floor is horizontally split into two narrow corner areas on 
		each side of the floor, and into a set of window tiles in between -->
	<rule name="Floor">
		<operator name="split">
			<param name="splitAxis" value="x"/>
			<param name="size">
				<element type="absolute" value="1.0"/>
				<element type="floating" value="tile_width" repeat="true"/>
				<element type="absolute" value="1.0"/>
			</param>
			<param name="name">
				<element value="Wall"/>
				<element value="Tile"/>
				<element value="Wall"/>
			</param>
		</operator>
	</rule>
	
	<!-- similarily, the front groundfloor is horizontally split into 
		two narrow corner areas on each side of the floor, 
		a special entrance tile on the right 
		and into a set of window tiles in between -->
	<rule name="Groundfloor">
		<operator name="split">
			<param name="splitAxis" value="x"/>
			<param name="size">
				<element type="absolute" value="1.0"/>
				<element type="floating" value="tile_width" repeat="true"/>
				<element type="floating" value="tile_width" />
				<element type="absolute" value="1.0"/>
			</param>
			<param name="name">
				<element value="Wall"/>
				<element value="Tile"/>
				<element value="EntranceTile"/>
				<element value="Wall"/>
			</param>
		</operator>
	</rule>

	<!-- a tile consists of a centered window element and 
		wall elements above, below, left and right -->
	<rule name="Tile">
		<operator name="split">
			<param name="splitAxis" value="x"/>
			<param name="size">
				<element type="floating" value="1.0"/>
				<element type="absolute" value="2.0"/>
				<element type="floating" value="1.0"/>
			</param>
			<param name="name">
				<element value="Wall"/>
				<element value="WallWindowWall"/>
				<element value="Wall"/>
			</param>
		</operator>
	</rule>
	
	<rule name="WallWindowWall">
		<operator name="split">
			<param name="splitAxis" value="y"/>
			<param name="size">
				<element type="absolute" value="1.0"/>
				<element type="absolute" value="1.5"/>
				<element type="floating" value="1.0"/>
			</param>
			<param name="name">
				<element value="Wall"/>
				<element value="Window"/>
				<element value="Wall"/>
			</param>
		</operator>
	</rule>
	
	<!-- similarily, the EntranceTile contains a centered Door element,
		but with no wall on spacing below -->
	<rule name="EntranceTile">
		<operator name="split">
			<param name="splitAxis" value="x"/>
			<param name="size">
				<element type="floating" value="1.0"/>
				<element type="absolute" value="2"/>
				<element type="floating" value="1.0"/>
			</param>
			<param name="name">
				<element value="SolidWall"/>
				<element value="DoorAndSolidWall"/>
				<element value="SolidWall"/>
			</param>
		</operator>
	</rule>
	
	<rule name="DoorAndSolidWall">
		<operator name="split">
			<param name="splitAxis" value="y"/>
			<param name="size">
				<element type="absolute" value="2.5"/>
				<element type="floating" value="2.0"/>
			</param>
			<param name="name">
				<element value="Door"/>
				<element value="SolidWall"/>
			</param>
		</operator>
	</rule>
	
	<!-- firstly, the depth and the depth position of the future window is set
		secondly, one of nine window textures is randomly selected
		finally, the window geometry asset is inserted -->
	<rule name="Window">
		<operator name="size">
			<param name="xSize" type="relative" value="1"/>
			<param name="ySize" type="relative" value="1"/>
			<param name="zSize" type="absolute" value="0.4"/>
		</operator>
		<operator name="translate">
			<param name="mode" value="rel"/>
			<param name="coordSystem" value="object"/>
			<param name="x" value="0"/>
			<param name="y" value="0"/>
			<param name="z" value="-0.25"/>
		</operator>
		<operator name="texture">
			<param name="texture" value="window_tex"/>
		</operator>
		<operator name="insert">
			<param name="geometryPath" value="window_asset"/>
		</operator>
	</rule>
	
	<!-- same for the door asset. Scaling, positioning, texture selection
		and geometry insert
		TODO: fix door uv bug (problem with uv handling on split?) -->
	<rule name="Door">
		<operator name="size">
			<param name="xSize" type="relative" value="1"/>
			<param name="ySize" type="relative" value="1"/>
			<param name="zSize" type="absolute" value="0.1"/>
		</operator>
		<operator name="translate">
			<param name="mode" value="rel"/>
			<param name="coordSystem" value="object"/>
			<param name="x" value="0"/>
			<param name="y" value="0"/>
			<param name="z" value="-0.4"/>
		</operator>
		<operator name="setupProjection">
			<param name="axesSelector" value="scope.xy"/>
			<param name="texWidth" type="absolute" value="scope.sx"/>
			<param name="texHeight" type="absolute" value="scope.sy"/>
		</operator>
		<operator name="texture">
			<param name="texture" value="frontdoor_tex"/>
		</operator>
	</rule>
	
	<!-- for the wall asset, setting the texture scale params u and v 
		guarantees a texture mapping that nicely fits over the whole facade -->
	<rule name="Wall">
		<operator name="color">
			<param name="s" value="wallColor"/>
		</operator>
	</rule>
	
	<rule name="SolidWall">
		<operator name="color">
			<param name="s" value="wallColor"/>
		</operator>
		<operator name="size">
			<param name="xSize" type="relative" value="1"/>
			<param name="ySize" type="relative" value="1"/>
			<param name="zSize" type="absolute" value="0.4"/>
		</operator>
		<operator name="translate">
			<param name="mode" value="rel"/>
			<param name="coordSystem" value="object"/>
			<param name="x" value="0"/>
			<param name="y" value="0"/>
			<param name="z" value="-0.4"/>
		</operator>
		<operator name="insert">
			<param name="geometryPath" value="cube_notex"/>
		</operator>
	</rule>
</rules>
